
 <!DOCTYPE HTML>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  
    <title>Android-源码分析之ListView | Edgar&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Edgar">
    

    
    <meta name="description" content="&amp;#x5728;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x535A;&amp;#x5BA2;&amp;#x5DF2;&amp;#x7ECF;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E86;ListView&amp;#x548C;Adapter&amp;#x4E86;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4E4B;&amp;#x524D;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x53EA;&amp;#x662F;&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="Android-源码分析之ListView">
<meta property="og:url" content="http://yoursite.com/2016/07/27/Android-源码分析之ListView/index.html">
<meta property="og:site_name" content="Edgar's Blog">
<meta property="og:description" content="&amp;#x5728;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x535A;&amp;#x5BA2;&amp;#x5DF2;&amp;#x7ECF;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E86;ListView&amp;#x548C;Adapter&amp;#x4E86;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4E4B;&amp;#x524D;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x53EA;&amp;#x662F;&amp;">
<meta property="og:image" content="http://yoursite.com/2016/07/27/Android-源码分析之ListView/1.png">
<meta property="og:image" content="http://yoursite.com/2016/07/27/Android-源码分析之ListView/2.png">
<meta property="og:image" content="http://yoursite.com/2016/07/27/Android-源码分析之ListView/3.png">
<meta property="og:updated_time" content="2016-08-05T15:55:00.290Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android-源码分析之ListView">
<meta name="twitter:description" content="&amp;#x5728;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x535A;&amp;#x5BA2;&amp;#x5DF2;&amp;#x7ECF;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E86;ListView&amp;#x548C;Adapter&amp;#x4E86;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4E4B;&amp;#x524D;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x53EA;&amp;#x662F;&amp;">

    
    <link rel="alternative" href="atom.xml" title="Edgar&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/unnamed4_n_mSY_icon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/profile.png">
    <link rel="apple-touch-icon-precomposed" href="/img/profile.png">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Edgar&#39;s Blog">Edgar&#39;s Blog</a></h1>
				<h2 class="blog-motto">等待执剑少年修炼归来！</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/07/27/Android-源码分析之ListView/" title="Android-源码分析之ListView" itemprop="url">Android-源码分析之ListView</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-07-27T02:52:44.000Z" itemprop="datePublished"> 發表於 2016-07-27</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
			<ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#ListView-缓存机制的实现"><span class="toc-number">1.</span> <span class="toc-text">ListView 缓存机制的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#RecycleBin原理概述"><span class="toc-number">1.1.</span> <span class="toc-text">RecycleBin原理概述</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ListView的优化"><span class="toc-number">2.</span> <span class="toc-text">ListView的优化</span></a></li></ol>
		
		</div>
		
		<p>&#x5728;&#x4E4B;&#x524D;&#x7684;&#x535A;&#x5BA2;&#x5DF2;&#x7ECF;&#x4ECB;&#x7ECD;&#x4E86;ListView&#x548C;Adapter&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x4E4B;&#x524D;&#x7BC7;&#x6587;&#x7AE0;&#x53EA;&#x662F;&#x7740;&#x773C;&#x4E8E;&#x57FA;&#x672C;&#x7684;&#x4F7F;&#x7528;&#x5E76;&#x6CA1;&#x6709;&#x8BB2;&#x5230;&#x5177;&#x4F53;&#x7684;&#x80CC;&#x540E;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4F1A;&#x4EE3;&#x5927;&#x5BB6;&#x8FC7;&#x4E0B;ListView&#x7684;&#x6E90;&#x4EE3;&#x7801;&#xFF0C;&#x8BA9;&#x5927;&#x5BB6;&#x4E86;&#x89E3;&#x4E0B;&#x6574;&#x4E2A;&#x539F;&#x7406;&#xFF1A;&#x91CD;&#x70B9;&#x662F;ListView &#x7F13;&#x5B58;&#x673A;&#x5236;</p>
<h5 id="ListView-&#x7F13;&#x5B58;&#x673A;&#x5236;&#x7684;&#x5B9E;&#x73B0;"><a href="#ListView-&#x7F13;&#x5B58;&#x673A;&#x5236;&#x7684;&#x5B9E;&#x73B0;" class="headerlink" title="ListView &#x7F13;&#x5B58;&#x673A;&#x5236;&#x7684;&#x5B9E;&#x73B0;"></a>ListView &#x7F13;&#x5B58;&#x673A;&#x5236;&#x7684;&#x5B9E;&#x73B0;</h5><h6 id="RecycleBin&#x539F;&#x7406;&#x6982;&#x8FF0;"><a href="#RecycleBin&#x539F;&#x7406;&#x6982;&#x8FF0;" class="headerlink" title="RecycleBin&#x539F;&#x7406;&#x6982;&#x8FF0;"></a>RecycleBin&#x539F;&#x7406;&#x6982;&#x8FF0;</h6><p>&#x5728;&#x4ECB;&#x7ECD;RecycleBin&#x539F;&#x7406;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x4ECB;&#x7ECD;&#x4E24;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;ActiveView&#x548C;ScrapView&#x3002;&#x6211;&#x4EEC;&#x77E5;&#x9053;ListView&#x4E2D;&#x5305;&#x542B;&#x4E24;&#x7C7B;&#x5B50;View&#xFF0C;&#x4E00;&#x7C7B;&#x662F;&#x53EF;&#x89C1;&#x7684;&#xFF0C;&#x663E;&#x793A;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C31;&#x662F;ActiveView&#xFF0C;&#x53E6;&#x4E00;&#x7C7B;&#x662F;&#x4E0D;&#x53EF;&#x89C1;&#x7684;&#x8FD9;&#x4E9B;&#x88AB;&#x79F0;&#x4E3A;ScrapView&#xFF08;Scrap&#x8868;&#x793A;&#x5E9F;&#x5F03;&#x7684;&#x610F;&#x601D;&#xFF09;ListView&#x4F1A;&#x628A;ScrapView&#x5220;&#x9664;&#x7684;&#x540C;&#x65F6;&#x653E;&#x5165;&#x5230;RecycleBin&#x4E2D;&#x7F13;&#x5B58;&#x8D77;&#x6765;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x6ED1;&#x52A8;ListView&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x6709;&#x4E00;&#x90E8;&#x5206;&#x5143;&#x7D20;&#x8FDB;&#x5165;&#x5C4F;&#x5E55;&#xFF0C;&#x4E00;&#x4E9B;item&#x4ECE;&#x5C4F;&#x5E55;&#x4E2D;&#x79FB;&#x51FA;&#xFF0C;&#x5728;&#x79FB;&#x5165;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x4ECE;RecycleBin&#x4E2D;&#x53D6;&#x51FA;&#x4E00;&#x4E2A;ScrapView&#xFF0C;&#x5C06;&#x5176;&#x4F5C;&#x4E3A;convertView&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;Adapter&#x7684;getView&#x65B9;&#x6CD5;&#xFF0C;&#x4ECE;&#x800C;&#x8FBE;&#x5230;View&#x590D;&#x7528;&#x7684;&#x76EE;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x5FC5;&#x5728;Adapter&#x7684;getView&#x65B9;&#x6CD5;&#x4E2D;&#x6267;&#x884C; LayoutInflater.inflate()&#x65B9;&#x6CD5;&#x4E86;&#xFF0C;&#x4ECE;&#x800C;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x6574;&#x4E2A;&#x6027;&#x80FD;&#xFF0C;&#x5728;&#x7F16;&#x7A0B;&#x7684;&#x4E16;&#x754C;&#x4E2D;&#x6709;&#x4E24;&#x4E2A;&#x4E1C;&#x897F;&#x4E00;&#x76F4;&#x662F;&#x77DB;&#x76FE;&#x7684;&#x90A3;&#x5C31;&#x662F;&#x65F6;&#x95F4;&#x548C;&#x7A7A;&#x95F4;&#xFF0C;&#x800C;ListView&#x4E2D;&#x5728;&#x8FD9;&#x4E24;&#x8005;&#x4E4B;&#x95F4;&#x505A;&#x4E86;&#x5F88;&#x597D;&#x7684;&#x5E73;&#x8861;&#xFF0C;&#x4E2A;&#x4EBA;&#x89C9;&#x5F97;&#x4E4B;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x8FD9;&#x70B9;&#x8FD8;&#x4F9D;&#x8D56;&#x4E8E;ListView item&#x7684;&#x4E00;&#x4E2A;&#x7279;&#x6027;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x6BCF;&#x4E2A;item&#x7684;&#x5E03;&#x5C40;&#x662F;&#x4E00;&#x81F4;&#x7684;&#x53EA;&#x4E0D;&#x8FC7;&#x6362;&#x4E86;&#x5185;&#x5BB9;&#x3002;</p>
<p><img src="/2016/07/27/Android-&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E4B;ListView/1.png" alt=""></p>
<figure class="highlight zephir"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RecycleBin</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Views that were on screen at the start of layout. This array is populated at the start of</span><br><span class="line">     * layout, and at the end of layout all view in mActiveViews are moved to mScrapViews.</span><br><span class="line">     * Views in mActiveViews represent a contiguous range of Views, with position of the first</span><br><span class="line">     * view store in mFirstActivePosition.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> View[] mActiveViews = <span class="keyword">new</span> View[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Unsorted views that can be used by the adapter as a convert view.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;View&gt;[] mScrapViews;</span><br><span class="line">	<span class="comment">//.....</span></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Fill ActiveViews with all of the children of the AbsListView.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> childCount The minimum number of views mActiveViews should hold</span><br><span class="line">     * <span class="doctag">@param</span> firstActivePosition The position of the first view that will be stored in</span><br><span class="line">     *        mActiveViews</span><br><span class="line">     */</span></span><br><span class="line">    void fillActiveViews(<span class="keyword">int</span> childCount, <span class="keyword">int</span> firstActivePosition) {</span><br><span class="line">        <span class="keyword">if</span> (mActiveViews.length &lt; childCount) {</span><br><span class="line">            mActiveViews = <span class="keyword">new</span> View[childCount];</span><br><span class="line">        }</span><br><span class="line">        mFirstActivePosition = firstActivePosition;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//noinspection MismatchedReadAndWriteOfArray</span></span><br><span class="line">        <span class="keyword">final</span> View[] activeViews = mActiveViews;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) {</span><br><span class="line">            View child = getChildAt(i);</span><br><span class="line">            AbsListView.LayoutParams lp = (AbsListView.LayoutParams) child.getLayoutParams();</span><br><span class="line">            <span class="comment">// Don&apos;t put header or footer views into the scrap heap</span></span><br><span class="line">            <span class="keyword">if</span> (lp != <span class="keyword">null</span> &amp;&amp; lp.viewType != ITEM_VIEW_TYPE_HEADER_OR_FOOTER) {</span><br><span class="line">                <span class="comment">// <span class="doctag">Note:</span>  We do place AdapterView.ITEM_VIEW_TYPE_IGNORE in active views.</span></span><br><span class="line">                <span class="comment">//        However, we will NOT place them into scrap views.</span></span><br><span class="line">                activeViews[i] = child;</span><br><span class="line">                <span class="comment">// Remember the position so that setupChild() doesn&apos;t reset state.</span></span><br><span class="line">                lp.scrappedFromPosition = firstActivePosition + i;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Get the view corresponding to the specified position. The view will be removed from</span><br><span class="line">     * mActiveViews if it is found.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> position The position to look up in mActiveViews</span><br><span class="line">     * <span class="doctag">@return</span> The view if it is found, null otherwise</span><br><span class="line">     */</span></span><br><span class="line">    View getActiveView(<span class="keyword">int</span> position) {</span><br><span class="line">        <span class="keyword">int</span> index = position - mFirstActivePosition;</span><br><span class="line">        <span class="keyword">final</span> View[] activeViews = mActiveViews;</span><br><span class="line">        <span class="keyword">if</span> (index &gt;=<span class="number">0</span> &amp;&amp; index &lt; activeViews.length) {</span><br><span class="line">            <span class="keyword">final</span> View match = activeViews[index];</span><br><span class="line">            activeViews[index] = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span> match;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * <span class="doctag">@return</span> A view from the ScrapViews collection. These are unordered.</span><br><span class="line">     */</span></span><br><span class="line">    View getScrapView(<span class="keyword">int</span> position) {</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> whichScrap = mAdapter.getItemViewType(position);</span><br><span class="line">        <span class="keyword">if</span> (whichScrap &lt; <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (mViewTypeCount == <span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">return</span> retrieveFromScrap(mCurrentScrap, position);</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (whichScrap &lt; mScrapViews.length) {</span><br><span class="line">            <span class="keyword">return</span> retrieveFromScrap(mScrapViews[whichScrap], position);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Puts a view into the list of scrap views.</span><br><span class="line">     * &lt;p&gt;</span><br><span class="line">     * If the list data hasn&apos;t changed or the adapter has stable IDs, views</span><br><span class="line">     * with transient state will be preserved for later retrieval.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> scrap The view to add</span><br><span class="line">     * <span class="doctag">@param</span> position The view&apos;s position within its parent</span><br><span class="line">     */</span></span><br><span class="line">    void addScrapView(View scrap, <span class="keyword">int</span> position) {</span><br><span class="line">        <span class="keyword">final</span> AbsListView.LayoutParams lp = (AbsListView.LayoutParams) scrap.getLayoutParams();</span><br><span class="line">        <span class="keyword">if</span> (lp == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">// Can&apos;t recycle, but we don&apos;t know anything about the view.</span></span><br><span class="line">            <span class="comment">// Ignore it completely.</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        lp.scrappedFromPosition = position;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Remove but don&apos;t scrap header or footer views, or views that</span></span><br><span class="line">        <span class="comment">// should otherwise not be recycled.</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> viewType = lp.viewType;</span><br><span class="line">        <span class="keyword">if</span> (!shouldRecycleViewType(viewType)) {</span><br><span class="line">            <span class="comment">// Can&apos;t recycle. If it&apos;s not a header or footer, which have</span></span><br><span class="line">            <span class="comment">// special handling and should be ignored, then skip the scrap</span></span><br><span class="line">            <span class="comment">// heap and we&apos;ll fully detach the view later.</span></span><br><span class="line">            <span class="keyword">if</span> (viewType != ITEM_VIEW_TYPE_HEADER_OR_FOOTER) {</span><br><span class="line">                getSkippedScrap().add(scrap);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        scrap.dispatchStartTemporaryDetach();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The the accessibility state of the view may change while temporary</span></span><br><span class="line">        <span class="comment">// detached and we do not allow detached views to fire accessibility</span></span><br><span class="line">        <span class="comment">// events. So we are announcing that the subtree changed giving a chance</span></span><br><span class="line">        <span class="comment">// to clients holding on to a view in this subtree to refresh it.</span></span><br><span class="line">        notifyViewAccessibilityStateChangedIfNeeded(</span><br><span class="line">                AccessibilityEvent.CONTENT_CHANGE_TYPE_SUBTREE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Don&apos;t scrap views that have transient state.</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> scrapHasTransientState = scrap.hasTransientState();</span><br><span class="line">        <span class="keyword">if</span> (scrapHasTransientState) {</span><br><span class="line">            <span class="keyword">if</span> (mAdapter != <span class="keyword">null</span> &amp;&amp; mAdapterHasStableIds) {</span><br><span class="line">                <span class="comment">// If the adapter has stable IDs, we can reuse the view for</span></span><br><span class="line">                <span class="comment">// the same data.</span></span><br><span class="line">                <span class="keyword">if</span> (mTransientStateViewsById == <span class="keyword">null</span>) {</span><br><span class="line">                    mTransientStateViewsById = <span class="keyword">new</span> LongSparseArray&lt;&gt;();</span><br><span class="line">                }</span><br><span class="line">                mTransientStateViewsById.put(lp.itemId, scrap);</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (!mDataChanged) {</span><br><span class="line">                <span class="comment">// If the data hasn&apos;t changed, we can reuse the views at</span></span><br><span class="line">                <span class="comment">// their old positions.</span></span><br><span class="line">                <span class="keyword">if</span> (mTransientStateViews == <span class="keyword">null</span>) {</span><br><span class="line">                    mTransientStateViews = <span class="keyword">new</span> SparseArray&lt;&gt;();</span><br><span class="line">                }</span><br><span class="line">                mTransientStateViews.put(position, scrap);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// Otherwise, we&apos;ll have to remove the view and start over.</span></span><br><span class="line">                getSkippedScrap().add(scrap);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">if</span> (mViewTypeCount == <span class="number">1</span>) {</span><br><span class="line">                mCurrentScrap.add(scrap);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                mScrapViews[viewType].add(scrap);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (mRecyclerListener != <span class="keyword">null</span>) {</span><br><span class="line">                mRecyclerListener.onMovedToScrapHeap(scrap);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>RecycleBin&#x7684;&#x4EE3;&#x7801;&#x4E0D;&#x662F;&#x5F88;&#x5927;&#x4F46;&#x662F;&#x5168;&#x90E8;&#x5728;&#x535A;&#x5BA2;&#x8BB2;&#x89E3;&#x6BCF;&#x4E2A;&#x7EC6;&#x8282;&#x4E00;&#x6765;&#x81EA;&#x5DF1;&#x4E5F;&#x4E0D;&#x662F;&#x5B8C;&#x5168;&#x61C2;&#x6BCF;&#x4E2A;&#x7EC6;&#x8282;&#xFF0C;&#x800C;&#x4E14;&#x592A;&#x5173;&#x6CE8;&#x7EC6;&#x8282;&#x6211;&#x4EEC;&#x5E38;&#x5E38;&#x4F1A;&#x9677;&#x5165;&#x7EC6;&#x8282;&#x800C;&#x770B;&#x4E0D;&#x5230;&#x6574;&#x4E2A;&#x539F;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x5206;&#x6790;&#x6E90;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;&#x4E0D;&#x8981;&#x592A;&#x7EA0;&#x7ED3;&#x7EC6;&#x8282;&#xFF0C;&#x7B49;&#x5230;&#x540E;&#x9762;&#x6709;&#x7591;&#x95EE;&#x6216;&#x8005;&#x9047;&#x5230;&#x95EE;&#x9898;&#x9700;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x65F6;&#x5019;&#x5728;&#x8BA4;&#x771F;&#x5206;&#x6790;&#x5BF9;&#x5E94;&#x7684;&#x7EC6;&#x8282;&#x3002;<br>&#x597D;&#x4E86;&#x8A00;&#x5F52;&#x6B63;&#x4F20;&#xFF0C;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x8D34;&#x51FA;&#x4E86;RecycleBin&#x7684;&#x5173;&#x952E;&#x4EE3;&#x7801;&#xFF0C;&#x6B63;&#x5982;&#x4E0A;&#x9762;&#x4ECB;&#x7ECD;&#x7684;RecycleBin&#x5305;&#x542B;mActiveViews&#xFF0C;&#x4EE5;&#x53CA;mScrapViews&#x8FD9;&#x4E24;&#x4E2A;&#x4E3B;&#x8981;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x8FD9;&#x91CC;&#x518D;&#x63D2;&#x5165;&#x4E00;&#x4E2A;&#x5206;&#x6790;&#x6E90;&#x4EE3;&#x7801;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#xFF1A;&#x5728;&#x5B66;&#x4E60;&#x6E90;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x5148;&#x770B;&#x82F1;&#x6587;&#x6CE8;&#x91CA;&#xFF0C;&#x4E00;&#x822C;Android&#x4EE3;&#x7801;&#x4E2D;&#x5927;&#x90E8;&#x5206;&#x90FD;&#x6709;&#x6BD4;&#x8F83;&#x8BE6;&#x7EC6;&#x7684;&#x6CE8;&#x91CA;&#x7684;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x4E9B;&#x6CE8;&#x91CA;&#x5F80;&#x5F80;&#x4F1A;&#x5FEB;&#x901F;&#x4E86;&#x89E3;&#x8FD9;&#x4E1C;&#x897F;&#x5230;&#x5E95;&#x662F;&#x5E72;&#x5417;&#x7684;&#xFF0C;&#x5230;&#x5E95;&#x8981;&#x4E0D;&#x8981;&#x7EE7;&#x7EED;&#x6DF1;&#x5165;&#x770B;&#x4E0B;&#x53BB;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x770B;&#x4E0B;mActiveViews &#x7684;&#x6CE8;&#x91CA;&#xFF1A;</p>
<blockquote>
<p>Views that were on screen at the start of layout. This array is populated at the start of layout, and at the end of layout all view in mActiveViews are moved to mScrapViews.Views in mActiveViews represent a contiguous range of Views, with position of the first view store in mFirstActivePosition.</p>
</blockquote>
<p>&#x5927;&#x4F53;&#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x5B83;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x7684;&#x662F;&#x5728;&#x6BCF;&#x6B21;&#x5F00;&#x59CB;&#x5E03;&#x5C40;&#x4E4B;&#x524D;&#x4F4D;&#x4E8E;&#x5C4F;&#x5E55;&#x4E0A;&#x7684;&#x90A3;&#x4E9B;item View&#xFF0C;&#x5728;&#x5E03;&#x5C40;&#x7ED3;&#x675F;&#x540E;&#x6240;&#x6709;&#x5B58;&#x5728;&#x4E8E;mActiveViews&#x7684;item View&#x90FD;&#x4F1A;&#x79FB;&#x5230;mScrapViews&#xFF0C;mActiveViews&#x5B58;&#x653E;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x8FDE;&#x7EED;&#x7684;&#x4ECE;mFirstActivePosition&#x4F4D;&#x7F6E;&#x5F00;&#x59CB;&#x5230;&#x5C4F;&#x5E55;&#x6240;&#x80FD;&#x663E;&#x793A;&#x4E0B;&#x7684;&#x6700;&#x5927;item&#x6570;&#x76EE;&#x3002;</p>
<p>&#x90A3;&#x4E48;mScrapViews &#x53C8;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>
<blockquote>
<p>Unsorted views that can be used by the adapter as a convert view.</p>
</blockquote>
<p>&#x4ECE;&#x6CE8;&#x91CA;&#x4E2D;&#x53EF;&#x4EE5;&#x4E86;&#x89E3;&#x5230;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x65E0;&#x5E8F;&#x6392;&#x5217;&#x7684;&#x5217;&#x8868;&#xFF0C;&#x8FD9;&#x4E9B;&#x89C6;&#x56FE;&#x53EF;&#x4EE5;&#x88AB;&#x4F20;&#x5165;Adapter&#x4E2D;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;convert view.</p>
<ul>
<li>fillActiveViews &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5C06;AbsListView&#x6240;&#x6709;&#x7684;&#x5B50;item &#x6DFB;&#x52A0;&#x5230;ActiveViews&#x4E2D;&#xFF0C;&#x5B83;&#x63A5;&#x6536;&#x4E24;&#x4E2A;&#x53C2;&#x6570;childCount&#x8868;&#x793A;&#x5C4F;&#x5E55;&#x663E;&#x793A;&#x7684;&#x5B50;item&#x7684;&#x6570;&#x76EE;&#xFF0C;firstActivePosition&#x8868;&#x793A;&#x5C4F;&#x5E55;&#x4E0A;&#x7B2C;&#x4E00;&#x4E2A;item&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x8FD9;&#x4E2A;&#x5F88;&#x7B80;&#x5355;&#x3002;</li>
<li>getActiveView &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5C06;&#x4F1A;&#x4F20;&#x5165;&#x4F4D;&#x7F6E;&#x53C2;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x4F1A;&#x4ECE;mActiveViews&#x4E2D;&#x5BFB;&#x627E;&#x5E76;&#x53D6;&#x51FA;item View&#xFF0C;&#x5982;&#x679C;&#x627E;&#x5230;&#x5728;mActiveViews&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;View&#x5C06;&#x4F1A;&#x88AB;&#x7F6E;&#x4E3A;null</li>
<li>addScrapView &#x8FD9;&#x4E2A;&#x4EE3;&#x7801;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x6240;&#x5904;&#x7406;&#x7684;&#x4EFB;&#x52A1;&#x5F88;&#x7B80;&#x5355;&#x5C31;&#x662F;&#x5C06;&#x5E9F;&#x5F03;&#x7684;View&#x6DFB;&#x52A0;&#x5230;mScrapViews&#x4E2D;&#xFF0C;getScrapView&#x76F8;&#x53CD;&#x5C31;&#x662F;&#x4ECE;ScrapView&#x4E2D;&#x53D6;&#x51FA;view&#x3002;</li>
</ul>
<p>&#x5927;&#x5BB6;&#x770B;&#x5B8C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x662F;&#x4E0D;&#x662F;&#x548C;&#x6211;&#x6709;&#x4E00;&#x6837;&#x7684;&#x611F;&#x89C9;&#xFF0C;&#x8FD9;&#x4EE3;&#x7801;&#x6709;&#x5565;&#x8425;&#x517B;&#xFF1F;&#x786E;&#x5B9E;&#x5982;&#x679C;&#x4E0D;&#x7ED3;&#x5408;ListView&#x4EE3;&#x7801;&#x6765;&#x5206;&#x6790;&#xFF0C;&#x662F;&#x5B8C;&#x5168;&#x770B;&#x4E0D;&#x51FA;RecycleBin&#x7684;&#x539F;&#x7406;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x4E86;&#x89E3;&#x5230;RecycleBin&#x4E2D;&#x6709;&#x4EC0;&#x4E48;&#x4E4B;&#x540E;&#x7686;&#x6765;&#x6765;&#x5C31;&#x9700;&#x8981;&#x770B;&#x5B83;&#x600E;&#x4E48;&#x5728;Listview&#x4E2D;&#x8D77;&#x5230;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x7684;&#x4F5C;&#x7528;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x6765;&#x8BB2;&#x89E3;&#x4E0B;ListView&#x548C;RecycleBin&#x5982;&#x4F55;&#x4EA4;&#x4E92;&#x5B9E;&#x73B0;&#x7F13;&#x5B58;&#x7684;&#xFF1A;</p>
<p>&#x4E3B;&#x8981;&#x5173;&#x6CE8;&#x5982;&#x4E0B;&#x4E24;&#x4E2A;&#x60C5;&#x51B5;&#xFF1A;</p>
<ul>
<li>ListView&#x7684;item View &#x56DE;&#x6536;&#x5230; RecycleBin</li>
<li>&#x4ECE;RecycleBin&#x4E2D;&#x53D6;&#x51FA;View&#x4F5C;&#x4E3A;ListView&#x7684;item View</li>
</ul>
<p>&#x6211;&#x4EEC;&#x4ECE;&#x7ED8;&#x5236;&#x7684;&#x89D2;&#x5EA6;&#x51FA;&#x53D1;&#xFF0C;&#x89C2;&#x5BDF;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x5728;&#x7ED8;&#x5236;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x5B9E;&#x73B0;&#x5B50;View&#x7684;&#x7F13;&#x5B58;&#xFF1A;</p>
<p>&#x9996;&#x5148;&#x5728;&#x5206;&#x6790;&#x4EE3;&#x7801;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x4E86;&#x89E3;&#x4E0B;ListView&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#xFF0C;&#x8FD9;&#x6837;&#x6709;&#x5229;&#x4E8E;&#x6211;&#x4EEC;&#x5BF9;&#x4EE3;&#x7801;&#x7684;&#x4E86;&#x89E3;&#xFF08;&#x8BF4;&#x767D;&#x4E86;&#x5C31;&#x662F;&#x77E5;&#x9053;&#x5728;&#x5B50;&#x7C7B;&#x627E;&#x4E0D;&#x5230;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x987A;&#x7740;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x627E;&#xFF09;</p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"><span class="type">ListView</span>-&gt; <span class="type">AbsListView</span> -&gt;<span class="type">AdapterView</span> -&gt; <span class="type">ViewGroup</span></span><br></pre></td></tr></table></figure>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>.onLayout(changed, l, t, r, b);</span><br><span class="line">    mInLayout = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> childCount = getChildCount();</span><br><span class="line">    <span class="keyword">if</span> (changed) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) {</span><br><span class="line">            getChildAt(i).forceLayout();</span><br><span class="line">        }</span><br><span class="line">        mRecycler.markChildrenDirty();</span><br><span class="line">    }</span><br><span class="line">    layoutChildren();</span><br><span class="line">    mInLayout = <span class="keyword">false</span>;</span><br><span class="line">    mOverscrollMax = (b - t) / OVERSCROLL_LIMIT_DIVISOR;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Move somewhere sane. This doesn&apos;t belong in onLayout().</span></span><br><span class="line">    <span class="keyword">if</span> (mFastScroll != <span class="keyword">null</span>) {</span><br><span class="line">        mFastScroll.onItemCountChanged(getChildCount(), mItemCount);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>onlayout&#x65B9;&#x6CD5;&#x662F;&#x5728;AbsListView&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;ListView&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x8FD9;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x5C5E;&#x4E8E;GridView&#x4EE5;&#x53CA;ListView&#x901A;&#x7528;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5C06;&#x5176;&#x653E;&#x5728;&#x7236;&#x7C7B;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x5728;&#x5E03;&#x5C40;&#x5927;&#x5C0F;&#x6216;&#x8005;&#x4F4D;&#x7F6E;&#x7B49;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x7684;&#x65F6;&#x5019;&#x5C06;&#x4F1A;&#x8C03;&#x7528;onLayout()&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4F1A;&#x5F3A;&#x5236;&#x8981;&#x6C42;&#x6240;&#x6709;&#x5B50;item&#x8FDB;&#x884C;&#x91CD;&#x7ED8;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4ED4;&#x7EC6;&#x770B;&#x4F1A;&#x53D1;&#x73B0;layoutChildren()&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x4E0B;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF1A;</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> layoutChildren() {</span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">		<span class="comment">//......</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> childrenTop = mListPadding.top;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> childrenBottom = mBottom - mTop - mListPadding.bottom;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> childCount = getChildCount();</span><br><span class="line">        <span class="keyword">int</span> <span class="keyword">index</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> delta = <span class="number">0</span>;</span><br><span class="line">        View sel;</span><br><span class="line">        View oldSel = <span class="keyword">null</span>;</span><br><span class="line">        View oldFirst = <span class="keyword">null</span>;</span><br><span class="line">        View newSel = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// Remember stuff we will need down below</span></span><br><span class="line">        <span class="keyword">switch</span> (mLayoutMode) {</span><br><span class="line">  		<span class="comment">//......</span></span><br><span class="line">        <span class="keyword">case</span> LAYOUT_MOVE_SELECTION:</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="comment">// Remember the previously selected view</span></span><br><span class="line">            <span class="keyword">index</span> = mSelectedPosition - mFirstPosition;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">index</span> &gt;= <span class="number">0</span> &amp;&amp; <span class="keyword">index</span> &lt; childCount) {</span><br><span class="line">                oldSel = getChildAt(<span class="keyword">index</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// Remember the previous first child</span></span><br><span class="line">            oldFirst = getChildAt(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (mNextSelectedPosition &gt;= <span class="number">0</span>) {</span><br><span class="line">                delta = mNextSelectedPosition - mSelectedPosition;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// Caution: newSel might be null</span></span><br><span class="line">            newSel = getChildAt(<span class="keyword">index</span> + delta);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">boolean</span> dataChanged = mDataChanged;</span><br><span class="line">        <span class="keyword">if</span> (dataChanged) {</span><br><span class="line">            handleDataChanged();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">       <span class="comment">//......</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> firstPosition = mFirstPosition;</span><br><span class="line">        <span class="keyword">final</span> RecycleBin recycleBin = mRecycler;</span><br><span class="line">        <span class="keyword">if</span> (dataChanged) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) {</span><br><span class="line">                recycleBin.addScrapView(getChildAt(i), firstPosition+i);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            recycleBin.fillActiveViews(childCount, firstPosition);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Clear out old views</span></span><br><span class="line">        detachAllViewsFromParent();</span><br><span class="line">        recycleBin.removeSkippedScrap();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (mLayoutMode) {</span><br><span class="line">        <span class="comment">//......</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">if</span> (childCount == <span class="number">0</span>) {</span><br><span class="line">                <span class="keyword">if</span> (!mStackFromBottom) {</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> position = lookForSelectablePosition(<span class="number">0</span>, <span class="keyword">true</span>);</span><br><span class="line">                    setSelectedPositionInt(position);</span><br><span class="line">                    sel = fillFromTop(childrenTop);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> position = lookForSelectablePosition(mItemCount - <span class="number">1</span>, <span class="keyword">false</span>);</span><br><span class="line">                    setSelectedPositionInt(position);</span><br><span class="line">                    sel = fillUp(mItemCount - <span class="number">1</span>, childrenBottom);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">if</span> (mSelectedPosition &gt;= <span class="number">0</span> &amp;&amp; mSelectedPosition &lt; mItemCount) {</span><br><span class="line">                    sel = fillSpecific(mSelectedPosition,</span><br><span class="line">                            oldSel == <span class="keyword">null</span> ? childrenTop : oldSel.getTop());</span><br><span class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (mFirstPosition &lt; mItemCount) {</span><br><span class="line">                    sel = fillSpecific(mFirstPosition,</span><br><span class="line">                            oldFirst == <span class="keyword">null</span> ? childrenTop : oldFirst.getTop());</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    sel = fillSpecific(<span class="number">0</span>, childrenTop);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Flush any cached views that did not get reused above</span></span><br><span class="line">        recycleBin.scrapActiveViews();</span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">       <span class="comment">//......</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5728;&#x4ECB;&#x7ECD;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5148;&#x770B;&#x4E0B;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x7247;&#xFF1A;<br><figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> int firstPosition = mFirstPosition;</span><br><span class="line"><span class="keyword">final</span> RecycleBin recycleBin = mRecycler;</span><br><span class="line"><span class="keyword">if</span> (dataChanged) <span class="comment">{</span><br><span class="line">    for (int i = 0; i &lt; childCount; i++) {</span><br><span class="line">        recycleBin.addScrapView(getChildAt(i), firstPosition+i);</span><br><span class="line">    }</span></span><br><span class="line">} <span class="keyword">else</span> <span class="comment">{</span><br><span class="line">    recycleBin.fillActiveViews(childCount, firstPosition);</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure></p>
<p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x4E0B;dataChanged&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x662F;&#x600E;&#x4E48;&#x63A7;&#x5236;&#x7684;&#xFF0C;&#x5176;&#x5B9E;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x662F;&#x5728;Adapter&#x8C03;&#x7528;&#x4E86;notifyDataSetChanged&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x77E5;Adapter&#x7684;&#x6570;&#x636E;&#x6E90;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;&#x6B64;&#x65F6;dataChanged&#x53D8;&#x91CF;&#x5C31;&#x4E3A;true&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x4F1A;&#x5C06;&#x5F53;&#x524D;&#x7684;&#x6240;&#x6709;&#x53EF;&#x89C6;item &#x901A;&#x8FC7;RecycleBin&#x7684;addScrapView&#x65B9;&#x6CD5;&#x5C06;&#x5176;&#x653E;&#x5165;RecycleBin&#x7684;&#x5E9F;&#x5F03;List&#x4E2D;&#xFF0C;&#x4F9B;&#x540E;&#x7EED;&#x590D;&#x7528;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x8BA9;&#x5927;&#x5BB6;&#x5730;&#x66F4;&#x6E05;&#x695A;&#x6211;&#x628A;&#x90A3;&#x4E9B;&#x65E0;&#x7528;&#x7684;&#x4EE3;&#x7801;&#x5220;&#x9664;&#x6389;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x4ECE;&#x7B2C;&#x4E00;&#x6B21;layout&#x7684;&#x60C5;&#x5F62;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;layout&#x7684;&#x65F6;&#x5019;&#x5E03;&#x5C40;&#x4E0A;&#x662F;&#x6CA1;&#x6709;&#x5B50;&#x5143;&#x7D20;&#x7684;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;dataChanged = false&#xFF0C;childCount = 0&#x6240;&#x4EE5;fillActiveViews&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E5F;&#x662F;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4F5C;&#x7528;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x6574;&#x4E2A;&#x5173;&#x952E;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (childCount == <span class="number">0</span>) {</span><br><span class="line">    <span class="keyword">if</span> (!mStackFromBottom) {</span><br><span class="line">        final <span class="keyword">int</span> position = lookForSelectablePosition(<span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line">        setSelectedPositionInt(position);</span><br><span class="line">        sel = fillFromTop(childrenTop);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        final <span class="keyword">int</span> position = lookForSelectablePosition(mItemCount - <span class="number">1</span>, <span class="literal">false</span>);</span><br><span class="line">        setSelectedPositionInt(position);</span><br><span class="line">        sel = fillUp(mItemCount - <span class="number">1</span>, childrenBottom);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x7684;&#x65B9;&#x5411;&#x6765;&#x8C03;&#x7528;fillFromTop&#x8FD8;&#x662F;fillUp&#x8FD9;&#x4E24;&#x4E2A;&#x5176;&#x5B9E;&#x529F;&#x80FD;&#x90FD;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x533A;&#x522B;&#x53EA;&#x662F;&#x5728;&#x4E8E;&#x65B9;&#x5411;&#x800C;&#x5DF2;&#xFF0C;&#x6211;&#x4EEC;&#x4EE5;fillFromTop&#x6765;&#x5206;&#x6790;&#xFF1A;</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Fills the list from top to bottom, starting with mFirstPosition</span><br><span class="line"> <span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@param nextTop The location where the top of the first item should be</span></span><br><span class="line"> <span class="keyword">*</span>        drawn</span><br><span class="line"> <span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@return The view that is currently selected</span></span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">private View fillFromTop(int nextTop) {</span><br><span class="line">    mFirstPosition = Math.min(mFirstPosition, mSelectedPosition);</span><br><span class="line">    mFirstPosition = Math.min(mFirstPosition, mItemCount - 1);</span><br><span class="line">    if (mFirstPosition <span class="variable">&lt; 0) {</span><br><span class="line">        mFirstPosition = 0;</span><br><span class="line">    }</span><br><span class="line">    return fillDown(mFirstPosition, nextTop);</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<p>&#x7247;&#x6BB5;&#x6CA1;&#x5B9E;&#x5728;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x529F;&#x80FD;&#x4F4D;&#x4E8E;fillDown&#x4E2D;&#x3002;</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="label">private</span> View fillDown(int pos, int nextTop) {</span><br><span class="line">    View <span class="keyword">selectedView </span>= null<span class="comment">;</span></span><br><span class="line">    int <span class="preprocessor">end</span> = (mBottom - mTop)<span class="comment">;</span></span><br><span class="line">    <span class="preprocessor">if</span> ((mGroupFlags &amp; CLIP_TO_PADDING_MASK) == CLIP_TO_PADDING_MASK) {</span><br><span class="line">        <span class="preprocessor">end</span> -= mListPadding.<span class="keyword">bottom;</span><br><span class="line"></span>    }</span><br><span class="line">    <span class="preprocessor">while</span> (nextTop &lt; <span class="preprocessor">end</span> &amp;&amp; pos &lt; mItemCount) {</span><br><span class="line">        // is this the <span class="keyword">selected </span><span class="keyword">item?</span><br><span class="line"></span>        <span class="keyword">boolean </span><span class="keyword">selected </span>= pos == mSelectedPosition<span class="comment">;</span></span><br><span class="line">        View child = makeAndAddView(pos, nextTop, true, mListPadding.left, <span class="keyword">selected);</span><br><span class="line"></span>        nextTop = child.getBottom() + mDividerHeight<span class="comment">;</span></span><br><span class="line">        <span class="preprocessor">if</span> (<span class="keyword">selected) </span>{</span><br><span class="line">            <span class="keyword">selectedView </span>= child<span class="comment">;</span></span><br><span class="line">        }</span><br><span class="line">        pos++<span class="comment">;</span></span><br><span class="line">    }</span><br><span class="line">    setVisibleRangeHint(mFirstPosition, mFirstPosition + getChildCount() - <span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">    return <span class="keyword">selectedView;</span><br><span class="line"></span>}</span><br></pre></td></tr></table></figure>
<p>&#x5728;fillDown&#x4E2D;&#x4F1A;&#x4ECE;&#x5C4F;&#x5E55;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x5F00;&#x59CB;&#xFF0C;&#x904D;&#x5386;&#x586B;&#x5145;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x8FD9;&#x91CC;&#x6700;&#x5173;&#x952E;&#x7684;&#x4EE3;&#x7801;&#x662F;makeAndAddView</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function">View <span class="title">makeAndAddView</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">int</span> y, <span class="keyword">boolean</span> flow, <span class="keyword">int</span> childrenLeft,</span><br><span class="line">        <span class="keyword">boolean</span> selected)</span> </span>{</span><br><span class="line">    View child;</span><br><span class="line">    <span class="keyword">if</span> (!mDataChanged) {</span><br><span class="line">        <span class="comment">// Try to use an existing view for this position</span></span><br><span class="line">        child = mRecycler.getActiveView(position);</span><br><span class="line">        <span class="keyword">if</span> (child != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">// Found it -- we&apos;re using an existing child</span></span><br><span class="line">            <span class="comment">// This just needs to be positioned</span></span><br><span class="line">            setupChild(child, position, y, flow, childrenLeft, selected, <span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> child;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// Make a new view for this position, or convert an unused view if possible</span></span><br><span class="line">    child = obtainView(position, mIsScrap);</span><br><span class="line">    <span class="comment">// This needs to be positioned and measured</span></span><br><span class="line">    setupChild(child, position, y, flow, childrenLeft, selected, mIsScrap[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> child;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5728;makeAndAddView&#x65B9;&#x6CD5;&#x4E2D;&#x5C1D;&#x8BD5;&#x4ECE;&#x4ECE;RecycleBin&#x5F53;&#x4E2D;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;ActiveView&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x5E03;&#x5C40;&#x65F6;&#x5019;RecycleBin&#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD4;&#x56DE;&#x7684;&#x662F;null&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x76F4;&#x63A5;&#x8C03;&#x7528;obtainView&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x6216;&#x8005;&#x5C1D;&#x8BD5;&#x4ECE;ScropView&#x4E2D;&#x6216;&#x5176;&#x4E00;&#x4E2A;&#x5B50;View&#x6765;&#x590D;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x65F6;&#x5019;ScropView&#x6570;&#x7EC4;&#x4E5F;&#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C31;&#x662F;&#x5728;obtainView&#x65B9;&#x6CD5;&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#x903B;&#x8F91;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x8FD9;&#x91CC;&#x63D0;&#x4E0B;&#xFF0C;&#x7D27;&#x63A5;&#x7740;&#x5C31;&#x5C06;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x5B50;View&#x901A;&#x8FC7;setupChild&#x6DFB;&#x52A0;&#x5230;ListView&#x4E2D;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x91CD;&#x70B9;&#x5173;&#x6CE8;&#x4E0B;obtainView&#xFF1A;</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="function">View <span class="title">obtainView</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">boolean</span>[] isScrap)</span> </span>{</span><br><span class="line">	<span class="comment">//.......</span></span><br><span class="line">    <span class="keyword">final</span> View scrapView = mRecycler.getScrapView(position);</span><br><span class="line">    <span class="keyword">final</span> View child = mAdapter.getView(position, scrapView, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (scrapView != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">if</span> (child != scrapView) {</span><br><span class="line">            <span class="comment">// Failed to re-bind the data, return scrap to the heap.</span></span><br><span class="line">            mRecycler.addScrapView(scrapView, position);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            isScrap[<span class="number">0</span>] = <span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">// Finish the temporary detach started in addScrapView().</span></span><br><span class="line">            child.dispatchFinishTemporaryDetach();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">	<span class="comment">//.......</span></span><br><span class="line">    <span class="keyword">return</span> child;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>obtainView&#x65B9;&#x6CD5;&#x4E5F;&#x662F;&#x53C8;&#x81ED;&#x53C8;&#x957F;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EA;&#x770B;&#x5173;&#x952E;&#x7684;&#x3002;&#x5B83;&#x4F1A;&#x8C03;&#x7528;getScrapView&#x4ECE;mRecycler&#x7684;ScrapView&#x4E2D;&#x83B7;&#x53D6;&#x53EF;&#x4EE5;&#x590D;&#x7528;&#x7684;scrapView&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x6240;&#x4EE5;scrapView&#x4E3A;null&#x3002;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x5927;&#x5BB6;&#x719F;&#x6089;&#x4E86;&#x628A;&#xFF0C;<br><figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> View child = mAdapter.getView(position, scrapView, <span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p>
<p>&#x4EC0;&#x4E48;&#x4E0D;&#x719F;&#x6089;&#xFF1F;&#x8FD9;&#x4E2A;&#x5C31;&#x662F;&#x8C03;&#x7528;Adapter&#x7684;getView&#x65B9;&#x6CD5;&#x554A;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x63D0;&#x5230;&#x7684;convertView&#x3002;&#x60F3;&#x5FC5;&#x770B;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5927;&#x5BB6;&#x90FD;&#x4F1A;&#x6709;&#x5370;&#x8C61;&#x5427;&#xFF1A;<br><figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> View getView(<span class="built_in">int</span> position, View convertView, ViewGroup parent) {</span><br><span class="line">    ViewHolder holder = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) {</span><br><span class="line">        holder=<span class="keyword">new</span> ViewHolder();</span><br><span class="line">        convertView = mInflater.inflate(R.layout.vlist2, <span class="keyword">null</span>);</span><br><span class="line">        holder.img = (ImageView)convertView.findViewById(R.id.img);</span><br><span class="line">        holder.title = (TextView)convertView.findViewById(R.id.title);</span><br><span class="line">        holder.info = (TextView)convertView.findViewById(R.id.info);</span><br><span class="line">        holder.viewBtn =(Button)convertView.findViewById(R.id.view_btn);</span><br><span class="line">        convertView.setTag(holder);</span><br><span class="line">    }<span class="keyword">else</span> {</span><br><span class="line">        holder = (ViewHolder)convertView.getTag();</span><br><span class="line">    }</span><br><span class="line">    holder.img.setBackgroundResource((Integer)mData.<span class="built_in">get</span>(position).<span class="built_in">get</span>(<span class="string">&quot;img&quot;</span>));</span><br><span class="line">    holder.title.setText((<span class="keyword">String</span>)mData.<span class="built_in">get</span>(position).<span class="built_in">get</span>(<span class="string">&quot;title&quot;</span>));</span><br><span class="line">    holder.info.setText((<span class="keyword">String</span>)mData.<span class="built_in">get</span>(position).<span class="built_in">get</span>(<span class="string">&quot;info&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> convertView;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x7B2C;&#x4E00;&#x6B21;layout&#x7684;&#x65F6;&#x5019;&#x6211;&#x4EEC;convertView&#x4E3A;&#x7A7A;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;inflate&#x4E00;&#x4E2A;&#x4F5C;&#x4E3A;convertView&#x5E76;&#x8FD4;&#x56DE;&#x3002;makeAndAddView#setupChild&#x5C31;&#x5C06;&#x8FD9;&#x4E2A;convertView&#x6DFB;&#x52A0;&#x5230;&#x5E03;&#x5C40;&#x4E2D;&#x3002;</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupChild</span><span class="params">(View child, <span class="keyword">int</span> position, <span class="keyword">int</span> y, boolean flowDown, <span class="keyword">int</span> childrenLeft,</span><br><span class="line">        boolean selected, boolean recycled)</span> </span>{</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    <span class="keyword">if</span> ((recycled &amp;&amp; !p.forceAdd) || (p.recycledHeaderFooter</span><br><span class="line">            &amp;&amp; p.viewType == AdapterView.ITEM_VIEW_TYPE_HEADER_OR_FOOTER)) {</span><br><span class="line">        attachViewToParent(child, flowDown ? -<span class="number">1</span> : <span class="number">0</span>, p);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        p.forceAdd = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (p.viewType == AdapterView.ITEM_VIEW_TYPE_HEADER_OR_FOOTER) {</span><br><span class="line">            p.recycledHeaderFooter = <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">        addViewInLayout(child, flowDown ? -<span class="number">1</span> : <span class="number">0</span>, p, <span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line"> 	<span class="comment">//......</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>setupChild&#x65B9;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x4E86;addViewInLayout&#x5C06;convertView&#x6DFB;&#x52A0;&#x5230;ListView&#x4E2D;&#x3002;</p>
<p><img src="/2016/07/27/Android-&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E4B;ListView/2.png" alt=""></p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x770B;&#x4E0B;&#x5728;&#x7ECF;&#x8FC7;&#x7B2C;&#x4E00;&#x6B21;layout&#x540E;&#xFF0C;&#x5F80;&#x540E;&#x7684;&#x5E03;&#x5C40;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x5E03;&#x5C40;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x5730;&#x65B9;&#x3002;<br>&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x4ECE;layoutChildren&#x5F00;&#x59CB;&#xFF0C;&#x8FD9;&#x91CC;&#x548C;&#x4E0A;&#x9762;&#x7684;&#x533A;&#x522B;&#x662F;&#x7531;&#x4E8E;childCount&#x4E0D;&#x4E3A;0&#x6240;&#x4EE5;fillActiveViews&#x4F1A;&#x5C06;Child Item&#x6DFB;&#x52A0;&#x5230;ActiviteView&#x6570;&#x7EC4;&#x4E2D;&#xFF0C;<br>&#x7D27;&#x63A5;&#x7740;&#x8C03;&#x7528;fillSpecific&#xFF0C;&#x8FD9;&#x4E2A;&#x4F1A;&#x4ECE;&#x6307;&#x5B9A;&#x7684;&#x4F4D;&#x7F6E;&#x5F00;&#x59CB;&#x52A0;&#x8F7D;Child item&#x3002;&#x7D27;&#x63A5;&#x7740;&#x8C03;&#x7528;makeAndAddView&#xFF0C;&#x8FD9;&#x65F6;&#x5019;makeAndAddView&#x8DD1;&#x7684;&#x903B;&#x8F91;&#x5C31;&#x548C;&#x4E4B;&#x524D;&#x4E0D;&#x4E00;&#x6837;&#x4E86;&#xFF0C;&#x7531;&#x4E8E;mDataChanged&#x4E3A;false&#xFF08;&#x5047;&#x8BBE;&#x5F53;&#x524D;&#x6570;&#x636E;&#x96C6;&#x6BCF;&#x53D8;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6CA1;&#x6709;&#x5BF9;&#x6570;&#x636E;&#x96C6;&#x8FDB;&#x884C;&#x589E;&#x5220;&#x7684;&#x64CD;&#x4F5C;&#xFF09;&#x8FD9;&#x6B21;&#x8C03;&#x7528;mRecycler.getActiveView&#x7684;&#x65F6;&#x5019;&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x4E0D;&#x662F;&#x7A7A;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x8C03;&#x7528;&#x4E86;RecycleBin&#x7684;fillActiveViews()&#x65B9;&#x6CD5;&#x6765;&#x7F13;&#x5B58;ChildView&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x8FDB;&#x5165;obtainView()&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x662F;&#x4F1A;&#x76F4;&#x63A5;&#x8C03;&#x7528;setupChild()&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x907F;&#x514D;&#x4E86;&#x91CD;&#x65B0;inflate&#x3002;<br>&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x4E0B;setupChild()&#xFF0C;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#x8C03;&#x7528;&#x4E86;detachAllViewsFromParent&#x6240;&#x4EE5;&#x5B50;View&#x5E94;&#x8BE5;&#x8C03;&#x7528;attachViewToParent()&#x65B9;&#x6CD5;&#x3002;&#x800C;&#x4E0D;&#x662F;&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;addViewInLayout&#x65B9;&#x6CD5;&#x3002;<br><img src="/2016/07/27/Android-&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E4B;ListView/3.png" alt=""></p>
<p>&#x597D;&#x4E86;&#x6211;&#x4EEC;&#x770B;&#x5B8C;&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x89C9;&#x5F97;&#x8FD8;&#x662F;&#x6CA1;&#x6709;&#x63A5;&#x89E6;&#x5230;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x7F13;&#x5B58;&#x673A;&#x5236;&#xFF0C;&#x6700;&#x5173;&#x952E;&#x7684;&#x90E8;&#x5206;&#x662F;&#x5728;&#x6ED1;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x5982;&#x4F55;&#x7F13;&#x5B58;&#x7684;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x770B;&#x4E0B;&#x8FD9;&#x90E8;&#x5206;&#x903B;&#x8F91;&#xFF1A;<br>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x6211;&#x4EEC;&#x7684;&#x4EA4;&#x4E92;&#x4E8B;&#x4EF6;&#x90FD;&#x4F1A;&#x88AB;&#x4F20;&#x9012;&#x5230;onTouchEvent&#x4E2D;&#xFF0C;&#x5728;ListView&#x4E5F;&#x4E0D;&#x4F8B;&#x5916;&#xFF0C;onTouchEvent&#x6709;&#x5F88;&#x591A;&#x4E8B;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x5173;&#x6CE8;ACTION_MOVE,&#x5728;&#x8FD9;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x4E2D;&#x6211;&#x4EEC;&#x91CD;&#x70B9;&#x5173;&#x6CE8;trackMotionScroll&#x65B9;&#x6CD5;&#xFF1A;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x987E;&#x540D;&#x601D;&#x4E49;&#x5C31;&#x662F;&#x8DDF;&#x8E2A;&#x6ED1;&#x52A8;&#x4E8B;&#x4EF6;&#xFF1A;&#x8FD9;&#x4E2A;&#x4EE3;&#x7801;&#x4E5F;&#x5F88;&#x957F;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x4ECE;&#x4E2D;&#x5173;&#x6CE8;&#x91CD;&#x70B9;&#x3002;</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="built_in">boolean</span> trackMotionScroll(<span class="built_in">int</span> deltaY, <span class="built_in">int</span> incrementalDeltaY) {</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> childCount = getChildCount();</span><br><span class="line">    <span class="keyword">if</span> (childCount == <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> firstTop = getChildAt(<span class="number">0</span>).getTop();</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> lastBottom = getChildAt(childCount - <span class="number">1</span>).getBottom();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Rect listPadding = mListPadding;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &quot;effective padding&quot; In this case is the amount of padding that affects</span></span><br><span class="line">    <span class="comment">// how much space should not be filled by items. If we don&apos;t clip to padding</span></span><br><span class="line">    <span class="comment">// there is no effective padding.</span></span><br><span class="line">    <span class="built_in">int</span> effectivePaddingTop = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">int</span> effectivePaddingBottom = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ((mGroupFlags &amp; CLIP_TO_PADDING_MASK) == CLIP_TO_PADDING_MASK) {</span><br><span class="line">        effectivePaddingTop = listPadding.top;</span><br><span class="line">        effectivePaddingBottom = listPadding.bottom;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">     <span class="comment">// FIXME account for grid vertical spacing too?</span></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> spaceAbove = effectivePaddingTop - firstTop;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> end = getHeight() - effectivePaddingBottom;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> spaceBelow = lastBottom - end;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> <span class="variable">height</span> = getHeight() - mPaddingBottom - mPaddingTop;</span><br><span class="line">    <span class="keyword">if</span> (deltaY &lt; <span class="number">0</span>) {</span><br><span class="line">        deltaY = Math.<span class="built_in">max</span>(-(<span class="variable">height</span> - <span class="number">1</span>), deltaY);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        deltaY = Math.<span class="built_in">min</span>(<span class="variable">height</span> - <span class="number">1</span>, deltaY);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (incrementalDeltaY &lt; <span class="number">0</span>) {</span><br><span class="line">        incrementalDeltaY = Math.<span class="built_in">max</span>(-(<span class="variable">height</span> - <span class="number">1</span>), incrementalDeltaY);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        incrementalDeltaY = Math.<span class="built_in">min</span>(<span class="variable">height</span> - <span class="number">1</span>, incrementalDeltaY);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> firstPosition = mFirstPosition;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update our guesses for where the first and last views are</span></span><br><span class="line">    <span class="keyword">if</span> (firstPosition == <span class="number">0</span>) {</span><br><span class="line">        mFirstPositionDistanceGuess = firstTop - listPadding.top;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        mFirstPositionDistanceGuess += incrementalDeltaY;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (firstPosition + childCount == mItemCount) {</span><br><span class="line">        mLastPositionDistanceGuess = lastBottom + listPadding.bottom;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        mLastPositionDistanceGuess += incrementalDeltaY;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">boolean</span> cannotScrollDown = (firstPosition == <span class="number">0</span> &amp;&amp;</span><br><span class="line">            firstTop &gt;= listPadding.top &amp;&amp; incrementalDeltaY &gt;= <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">boolean</span> cannotScrollUp = (firstPosition + childCount == mItemCount &amp;&amp;</span><br><span class="line">            lastBottom &lt;= getHeight() - listPadding.bottom &amp;&amp; incrementalDeltaY &lt;= <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cannotScrollDown || cannotScrollUp) {</span><br><span class="line">        <span class="keyword">return</span> incrementalDeltaY != <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">boolean</span> down = incrementalDeltaY &lt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">boolean</span> inTouchMode = isInTouchMode();</span><br><span class="line">    <span class="keyword">if</span> (inTouchMode) {</span><br><span class="line">        hideSelector();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> headerViewsCount = getHeaderViewsCount();</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> footerViewsStart = mItemCount - getFooterViewsCount();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span> start = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (down) {</span><br><span class="line">        <span class="built_in">int</span> top = -incrementalDeltaY;</span><br><span class="line">        <span class="keyword">if</span> ((mGroupFlags &amp; CLIP_TO_PADDING_MASK) == CLIP_TO_PADDING_MASK) {</span><br><span class="line">            top += listPadding.top;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) {</span><br><span class="line">            <span class="keyword">final</span> View child = getChildAt(i);</span><br><span class="line">            <span class="keyword">if</span> (child.getBottom() &gt;= top) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                count++;</span><br><span class="line">                <span class="built_in">int</span> position = firstPosition + i;</span><br><span class="line">                <span class="keyword">if</span> (position &gt;= headerViewsCount &amp;&amp; position &lt; footerViewsStart) {</span><br><span class="line">                    <span class="comment">// The view will be rebound to new data, clear any</span></span><br><span class="line">                    <span class="comment">// system-managed transient state.</span></span><br><span class="line">                    child.clearAccessibilityFocus();</span><br><span class="line">                    mRecycler.addScrapView(child, position);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="built_in">int</span> bottom = getHeight() - incrementalDeltaY;</span><br><span class="line">        <span class="keyword">if</span> ((mGroupFlags &amp; CLIP_TO_PADDING_MASK) == CLIP_TO_PADDING_MASK) {</span><br><span class="line">            bottom -= listPadding.bottom;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = childCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) {</span><br><span class="line">            <span class="keyword">final</span> View child = getChildAt(i);</span><br><span class="line">            <span class="keyword">if</span> (child.getTop() &lt;= bottom) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                start = i;</span><br><span class="line">                count++;</span><br><span class="line">                <span class="built_in">int</span> position = firstPosition + i;</span><br><span class="line">                <span class="keyword">if</span> (position &gt;= headerViewsCount &amp;&amp; position &lt; footerViewsStart) {</span><br><span class="line">                    <span class="comment">// The view will be rebound to new data, clear any</span></span><br><span class="line">                    <span class="comment">// system-managed transient state.</span></span><br><span class="line">                    child.clearAccessibilityFocus();</span><br><span class="line">                    mRecycler.addScrapView(child, position);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    mMotionViewNewTop = mMotionViewOriginalTop + deltaY;</span><br><span class="line">    mBlockLayoutRequests = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) {</span><br><span class="line">        detachViewsFromParent(start, count);</span><br><span class="line">        mRecycler.removeSkippedScrap();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// invalidate before moving the children to avoid unnecessary invalidate</span></span><br><span class="line">    <span class="comment">// calls to bubble up from the children all the way to the top</span></span><br><span class="line">    <span class="keyword">if</span> (!awakenScrollBars()) {</span><br><span class="line">       invalidate();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    offsetChildrenTopAndBottom(incrementalDeltaY);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (down) {</span><br><span class="line">        mFirstPosition += count;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> absIncrementalDeltaY = Math.<span class="built_in">abs</span>(incrementalDeltaY);</span><br><span class="line">    <span class="keyword">if</span> (spaceAbove &lt; absIncrementalDeltaY || spaceBelow &lt; absIncrementalDeltaY) {</span><br><span class="line">        fillGap(down);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!inTouchMode &amp;&amp; mSelectedPosition != INVALID_POSITION) {</span><br><span class="line">        <span class="keyword">final</span> <span class="built_in">int</span> childIndex = mSelectedPosition - mFirstPosition;</span><br><span class="line">        <span class="keyword">if</span> (childIndex &gt;= <span class="number">0</span> &amp;&amp; childIndex &lt; getChildCount()) {</span><br><span class="line">            positionSelector(mSelectedPosition, getChildAt(childIndex));</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (mSelectorPosition != INVALID_POSITION) {</span><br><span class="line">        <span class="keyword">final</span> <span class="built_in">int</span> childIndex = mSelectorPosition - mFirstPosition;</span><br><span class="line">        <span class="keyword">if</span> (childIndex &gt;= <span class="number">0</span> &amp;&amp; childIndex &lt; getChildCount()) {</span><br><span class="line">            positionSelector(INVALID_POSITION, getChildAt(childIndex));</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        mSelectorRect.setEmpty();</span><br><span class="line">    }</span><br><span class="line">    mBlockLayoutRequests = <span class="keyword">false</span>;</span><br><span class="line">    invokeOnItemScrollListener();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F20;&#x5165;&#x4E24;&#x4E2A;&#x53C2;&#x6570;deltaY&#x8868;&#x793A;&#x4ECE;&#x624B;&#x6307;&#x6700;&#x521D;&#x6309;&#x4E0B;&#x65F6;&#x7684;&#x4F4D;&#x7F6E;&#x5230;&#x5F53;&#x524D;&#x624B;&#x6307;&#x6240;&#x5904;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;incrementalDeltaY&#x5219;&#x8868;&#x793A;&#x76F8;&#x90BB;&#x4E24;&#x6B21;&#x5728;Y&#x65B9;&#x5411;&#x4E0A;&#x4F4D;&#x7F6E;&#x7684;&#x6539;&#x53D8;&#x91CF;&#xFF0C;incrementalDeltaY&#x7684;&#x6B63;&#x8D1F;&#x503C;&#x5C31;&#x53EF;&#x4EE5;&#x5224;&#x65AD;&#x6211;&#x4EEC;&#x5F53;&#x524D;&#x7684;&#x6ED1;&#x52A8;&#x65B9;&#x5411;&#x4E86;&#x3002;&#xFF08;incrementalDeltaY&#x5C0F;&#x4E8E;0&#xFF0C;&#x8868;&#x793A;&#x5411;&#x4E0B;&#x6ED1;&#x52A8;&#xFF0C;&#x5927;&#x4E8E;0&#x5C31;&#x662F;&#x5411;&#x4E0A;&#x6ED1;&#x52A8;&#xFF09;&#x5728;&#x8FD9;&#x4E2A;&#x90E8;&#x5206;&#x903B;&#x8F91;&#x4E2D;&#x5C06;&#x4F1A;&#x6839;&#x636E;&#x8FB9;&#x7F18;&#x4F5C;&#x4E3A;&#x5224;&#x65AD;&#x4F9D;&#x636E;&#x5982;&#x679C;&#x5B50;View&#x7684;bottom&#x503C;&#x5C0F;&#x4E8E;top&#x503C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;&#x5B50;View&#x79FB;&#x51FA;&#x5C4F;&#x5E55;&#x4E86;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x8C03;&#x7528;RecycleBin&#x7684;addScrapView()&#x65B9;&#x6CD5;&#x5C06;&#x8FD9;&#x4E2A;View&#x52A0;&#x5165;&#x5230;&#x5E9F;&#x5F03;&#x7F13;&#x5B58;&#x5F53;&#x4E2D;&#xFF0C;&#x4E0A;&#x9762;&#x4ECB;&#x7ECD;&#x4E86;&#x79FB;&#x51FA;&#x5C4F;&#x5E55;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x7531;&#x4E8E;&#x754C;&#x9762;&#x663E;&#x793A;&#x7684;&#x5B50;View&#x662F;&#x56FA;&#x5B9A;&#x7684;&#x6240;&#x4EE5;&#x6709;&#x79FB;&#x51FA;&#x5C31;&#x6709;&#x79FB;&#x5165;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x4E0B;&#x8FD9;&#x90E8;&#x5206;&#x903B;&#x8F91;&#xFF1A;<br>&#x5982;&#x679C;ListView&#x4E2D;&#x6700;&#x540E;&#x4E00;&#x4E2A;View&#x7684;&#x5E95;&#x90E8;&#x5DF2;&#x7ECF;&#x79FB;&#x5165;&#x4E86;&#x5C4F;&#x5E55;&#xFF0C;&#x6216;&#x8005;ListView&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;View&#x7684;&#x9876;&#x90E8;&#x79FB;&#x5165;&#x4E86;&#x5C4F;&#x5E55;&#xFF0C;&#x5C31;&#x4F1A;&#x8C03; &#x7528;fillGap()&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x4E0B;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF1A;<br><figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> fillGap(<span class="keyword">boolean</span> down) {</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> <span class="keyword">count</span> = getChildCount();</span><br><span class="line">    <span class="keyword">if</span> (down) {</span><br><span class="line">        <span class="keyword">int</span> paddingTop = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ((mGroupFlags &amp; CLIP_TO_PADDING_MASK) == CLIP_TO_PADDING_MASK) {</span><br><span class="line">            paddingTop = getListPaddingTop();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> startOffset = <span class="keyword">count</span> &gt; <span class="number">0</span> ? getChildAt(<span class="keyword">count</span> - <span class="number">1</span>).getBottom() + mDividerHeight :</span><br><span class="line">                paddingTop;</span><br><span class="line">        fillDown(mFirstPosition + <span class="keyword">count</span>, startOffset);</span><br><span class="line">        correctTooHigh(getChildCount());</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">int</span> paddingBottom = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ((mGroupFlags &amp; CLIP_TO_PADDING_MASK) == CLIP_TO_PADDING_MASK) {</span><br><span class="line">            paddingBottom = getListPaddingBottom();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> startOffset = <span class="keyword">count</span> &gt; <span class="number">0</span> ? getChildAt(<span class="number">0</span>).getTop() - mDividerHeight :</span><br><span class="line">                getHeight() - paddingBottom;</span><br><span class="line">        fillUp(mFirstPosition - <span class="number">1</span>, startOffset);</span><br><span class="line">        correctTooLow(getChildCount());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x989D;&#xFF0C;&#x53C8;&#x56DE;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x5728;fillGap&#x53C8;&#x8C03;&#x7528;&#x4E86;fillDown/fillUp&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x8C03;&#x7528;makeAndAddView&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x65F6;&#x5019;&#x7684;makeAndAddView&#x6D41;&#x7A0B;&#x53C8;&#x548C;&#x4E0A;&#x9762;&#x4E0D;&#x5927;&#x4E00;&#x6837;&#x4E86;&#x3002;&#x8FD9;&#x65F6;&#x5019;mRecycler.getActiveView&#x8FD4;&#x56DE;&#x7684;&#x662F;null</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function">View <span class="title">makeAndAddView</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">int</span> y, <span class="keyword">boolean</span> flow, <span class="keyword">int</span> childrenLeft,</span><br><span class="line">        <span class="keyword">boolean</span> selected)</span> </span>{</span><br><span class="line">    View child;</span><br><span class="line">    <span class="keyword">if</span> (!mDataChanged) {</span><br><span class="line">        <span class="comment">// Try to use an existing view for this position</span></span><br><span class="line">        child = mRecycler.getActiveView(position);</span><br><span class="line">        <span class="keyword">if</span> (child != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">// Found it -- we&apos;re using an existing child</span></span><br><span class="line">            <span class="comment">// This just needs to be positioned</span></span><br><span class="line">            setupChild(child, position, y, flow, childrenLeft, selected, <span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> child;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// Make a new view for this position, or convert an unused view if possible</span></span><br><span class="line">    child = obtainView(position, mIsScrap);</span><br><span class="line">    <span class="comment">// This needs to be positioned and measured</span></span><br><span class="line">    setupChild(child, position, y, flow, childrenLeft, selected, mIsScrap[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> child;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x662F;null&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E0B;getActiveView&#xFF1A;<br><figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">View getActiveView(<span class="keyword">int</span> position) {</span><br><span class="line">    <span class="keyword">int</span> <span class="keyword">index</span> = position - mFirstActivePosition;</span><br><span class="line">    <span class="keyword">final</span> View[] activeViews = mActiveViews;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">index</span> &gt;=<span class="number">0</span> &amp;&amp; <span class="keyword">index</span> &lt; activeViews.length) {</span><br><span class="line">        <span class="keyword">final</span> View match = activeViews[<span class="keyword">index</span>];</span><br><span class="line">        activeViews[<span class="keyword">index</span>] = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> match;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x7531;&#x4E8E;&#x4E4B;&#x524D;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5DF2;&#x7ECF;&#x88AB;&#x8C03;&#x7528;&#x8FC7;&#x4E86;&#x5B83;&#x4F1A;&#x5C06;activeViews[index]&#x7F6E;&#x4E3A;null&#x6240;&#x4EE5;&#x8FD8;&#x4F1A;&#x8C03;&#x7528;obtainView&#xFF0C;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x5BF9;&#x8BE5;&#x65B9;&#x6CD5;&#x505A;&#x4E86;&#x5206;&#x6790;&#xFF0C;&#x5B83;&#x4F1A;&#x8C03;&#x7528;getScrapView()&#x65B9;&#x6CD5;&#x6765;&#x5C1D;&#x8BD5;&#x4ECE;&#x5E9F;&#x5F03;&#x7F13;&#x5B58;&#x4E2D;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;View&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#x5219;&#x4F1A;inflate&#x4E00;&#x4E2A;&#x8FD4;&#x56DE;&#x3002;</p>
<h5 id="ListView&#x7684;&#x4F18;&#x5316;"><a href="#ListView&#x7684;&#x4F18;&#x5316;" class="headerlink" title="ListView&#x7684;&#x4F18;&#x5316;"></a>ListView&#x7684;&#x4F18;&#x5316;</h5><p>&#x4E0A;&#x9762;&#x4ECB;&#x7ECD;&#x7684;&#x53EA;&#x662F;ListView&#x7684;&#x7F13;&#x5B58;&#x673A;&#x5236;&#xFF0C;&#x4E86;&#x89E3;&#x4E86;&#x6574;&#x4E2A;&#x7F13;&#x5B58;&#x673A;&#x5236;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5145;&#x5206;&#x5229;&#x7528;convertView&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;inflate&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x6574;&#x4E2A;ListView&#x53EA;&#x52A0;&#x8F7D;&#x4E00;&#x5C4F;&#x7684;&#x5E03;&#x5C40;&#xFF0C;&#x4E4B;&#x540E;&#x6ED1;&#x52A8;&#x51FA;&#x6765;&#x7684;item&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x52A0;&#x8F7D;&#x7684;&#x5E03;&#x5C40;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x770B;&#x4E0B;&#x4E0B;&#x9762;&#x7684;getView&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;ViewHolder&#xFF0C;&#x8FD8;&#x6709;set/getTag&#x8FD9;&#x662F;&#x5E72;&#x5565;&#x7528;&#x7684;&#xFF1F;</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> View getView(<span class="built_in">int</span> position, View convertView, ViewGroup parent) {</span><br><span class="line">    ViewHolder holder = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) {</span><br><span class="line">        holder=<span class="keyword">new</span> ViewHolder();</span><br><span class="line">        convertView = mInflater.inflate(R.layout.vlist2, <span class="keyword">null</span>);</span><br><span class="line">        holder.img = (ImageView)convertView.findViewById(R.id.img);</span><br><span class="line">        holder.title = (TextView)convertView.findViewById(R.id.title);</span><br><span class="line">        holder.info = (TextView)convertView.findViewById(R.id.info);</span><br><span class="line">        holder.viewBtn =(Button)convertView.findViewById(R.id.view_btn);</span><br><span class="line">        convertView.setTag(holder);</span><br><span class="line">    }<span class="keyword">else</span> {</span><br><span class="line">        holder = (ViewHolder)convertView.getTag();</span><br><span class="line">    }</span><br><span class="line">    holder.img.setBackgroundResource((Integer)mData.<span class="built_in">get</span>(position).<span class="built_in">get</span>(<span class="string">&quot;img&quot;</span>));</span><br><span class="line">    holder.title.setText((<span class="keyword">String</span>)mData.<span class="built_in">get</span>(position).<span class="built_in">get</span>(<span class="string">&quot;title&quot;</span>));</span><br><span class="line">    holder.info.setText((<span class="keyword">String</span>)mData.<span class="built_in">get</span>(position).<span class="built_in">get</span>(<span class="string">&quot;info&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> convertView;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5176;&#x5B9E;&#x4F7F;&#x7528;ViewHolder&#xFF0C;&#x8FD8;&#x6709;set/getTag&#x662F;&#x4E3A;&#x4E86;&#x8282;&#x7701;findViewById&#x7684;&#x65F6;&#x95F4;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x4F7F;&#x7528;ViewHolder&#xFF0C;&#x6BCF;&#x6B21;getView&#x7684;&#x65F6;&#x5019;&#x90FD;&#x9700;&#x8981;&#x5F97;&#x5230;&#x4E00;&#x6B21;&#x5B50;&#x5E03;&#x5C40;&#xFF0C;&#x800C;&#x8FD9;&#x4E5F;&#x662F;&#x5F88;&#x8017;&#x65F6;&#x5E76;&#x4E14;&#x8017;&#x8D44;&#x6E90;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E86;ViewHolder&#x4F5C;&#x4E3A;&#x5B50;&#x5E03;&#x5C40;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x4F7F;&#x7528;View&#x7684;setTag&#x65B9;&#x6CD5;&#x5C06;&#x7F13;&#x5B58;&#x4E0E;&#x6BCF;&#x4E2A;item&#x7ED1;&#x5B9A;&#xFF0C;&#x5219;&#x4E5F;&#x53EF;&#x4EE5;&#x7701;&#x53BB;&#x4E86;findViewById&#x7684;&#x65F6;&#x95F4;&#xFF08;&#x8FD9;&#x91CC;&#x6211;&#x4E2A;&#x4EBA;&#x7684;&#x7406;&#x89E3;&#x662F;&#x5C06;id&#x4E0E;ViewHolder&#x4E2D;&#x7684;View&#x7ED1;&#x5B9A;&#x8D77;&#x6765;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7406;&#x89E3;&#x9519;&#x8BEF;&#x6B22;&#x8FCE;&#x66F4;&#x6B63;&#xFF09;<br>&#x8FD9;&#x91CC;&#x8FD8;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x4E00;&#x70B9;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x9700;&#x8981;&#x5C06;ViewHolder&#x8BBE;&#x7F6E;&#x4E3A;&#x9759;&#x6001;&#x7684;&#x56E0;&#x4E3A;&#x56E0;&#x4E3A;&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;&#x4E0D;&#x6301;&#x6709;&#x5916;&#x90E8;&#x7C7B;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#x3002;</p>
<p>&#x603B;&#x7ED3;&#x5982;&#x4E0B;&#xFF1A;&#x57FA;&#x672C;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x5F0F;</p>
<ul>
<li>&#x4F7F;&#x7528;ConvertView&#x590D;&#x7528;&#x673A;&#x5236;</li>
<li>&#x4F7F;&#x7528;ViewHolder</li>
<li>&#x4F7F;&#x7528;set/getTag</li>
</ul>
<p>ListView Item&#x5E26;&#x6709;&#x56FE;&#x7247;&#x7684;&#x60C5;&#x51B5;&#xFF1A;</p>
<p>&#x6211;&#x4EEC;&#x5728;&#x5F00;&#x53D1;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x9047;&#x5230;ListView&#x4E2D;&#x6BCF;&#x4E2A;item&#x90FD;&#x6709;&#x4E00;&#x4E2A;Image&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x8FD9;&#x4E2A;&#x5728;Music&#x5E94;&#x7528;&#x4E2D;&#x5341;&#x5206;&#x5E38;&#x89C1;&#xFF0C;<br>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x5BF9;&#x8FD9;&#x4E9B;&#x56FE;&#x50CF;&#x7684;&#x52A0;&#x8F7D;&#x4F7F;&#x7528;&#x56FE;&#x7247;&#x7F13;&#x5B58;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x52A0;&#x8F7D;&#x8FD9;&#x4E9B;&#x56FE;&#x7247;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x52A0;&#x8F7D;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E5F;&#x9762;&#x4E34;&#x8FD9;&#x7A7A;&#x95F4;&#x548C;&#x65F6;&#x95F4;&#x7684;&#x5E73;&#x8861;&#x95EE;&#x9898;&#x3002;<br>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x9488;&#x5BF9;&#x56FE;&#x7247;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#x6BD4;&#x5982;&#x5728;&#x56FE;&#x7247;&#x89E3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x964D;&#x4F4E;&#x50CF;&#x7D20;&#x989C;&#x8272;&#x4FE1;&#x606F;&#xFF0C;&#x53BB;&#x6389;&#x900F;&#x660E;&#x5EA6;&#x7B49;&#xFF0C;&#x6216;&#x8005;&#x5728;&#x8BBE;&#x8BA1;&#x8D44;&#x6E90;&#x7684;&#x65F6;&#x5019;&#x5C3D;&#x91CF;&#x51CF;&#x5C0F;&#x56FE;&#x7247;&#x8D44;&#x6E90;&#x7684;&#x5C3A;&#x5BF8;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x4E0D;&#x9700;&#x8981;&#x52A0;&#x8F7D;&#x5728;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x5728;&#x6ED1;&#x52A8;&#x4E0D;&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#x6ED1;&#x52A8;&#x505C;&#x6B62;&#x7684;&#x65F6;&#x5019;&#x52A0;&#x8F7D;&#x56FE;&#x7247;<br>&#x4E0B;&#x9762;&#x662F;&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x73B0;&#x4F8B;&#x5B50;&#xFF1A;<br>&#x8F6C;&#x8F7D;&#x81EA; <a href="http://blog.csdn.net/yy1300326388/article/details/45153813" target="_blank" rel="external">http://blog.csdn.net/yy1300326388/article/details/45153813</a></p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="comment">//&#x5B9A;&#x4E49;&#x5F53;&#x524D;listview&#x662F;&#x5426;&#x5728;&#x6ED1;&#x52A8;&#x72B6;&#x6001;</span></span><br><span class="line"><span class="keyword">private</span>  <span class="keyword">boolean</span> scrollState=<span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setScrollState</span><span class="params">(<span class="keyword">boolean</span> scrollState)</span> </span>{</span><br><span class="line">    <span class="keyword">this</span>.scrollState = scrollState;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//&#x5B9E;&#x4F53;&#x7C7B;</span></span><br><span class="line">UserEnity userEnity=lists.<span class="keyword">get</span>(position);</span><br><span class="line"><span class="keyword">if</span> (!scrollState){<span class="comment">//&#x5982;&#x679C;&#x5F53;&#x524D;&#x4E0D;&#x662F;&#x6ED1;&#x52A8;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x6211;&#x4EEC;&#x586B;&#x5145;&#x771F;&#x6570;&#x636E;</span></span><br><span class="line">    <span class="comment">//&#x586B;&#x5145;&#x6570;&#x636E;</span></span><br><span class="line">    viewHolder.tv_name.setText(userEnity.getName());</span><br><span class="line">    <span class="comment">//&#x8BBE;&#x7F6E;Tag&#x4E2D;&#x6570;&#x636E;&#x4E3A;&#x7A7A;&#x8868;&#x793A;&#x6570;&#x636E;&#x5DF2;&#x586B;&#x5145;</span></span><br><span class="line">    viewHolder.tv_name.setTag(<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">//&#x52A0;&#x8F7D;&#x56FE;&#x7247;</span></span><br><span class="line">    ImageLoader.getInstance().displayImage(img_url,viewHolder.iv_icon);</span><br><span class="line">    <span class="comment">//&#x8BBE;&#x7F6E;tag&#x4E3A;1&#x8868;&#x793A;&#x5DF2;&#x52A0;&#x8F7D;&#x8FC7;&#x6570;&#x636E;</span></span><br><span class="line">    viewHolder.iv_icon.setTag(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">}<span class="keyword">else</span>{<span class="comment">//&#x5982;&#x679C;&#x5F53;&#x524D;&#x662F;&#x6ED1;&#x52A8;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x6211;&#x4EEC;&#x586B;&#x5145;&#x5047;&#x6570;&#x636E;</span></span><br><span class="line">    viewHolder.tv_name.setText(<span class="string">&quot;&#x52A0;&#x8F7D;&#x4E2D;&quot;</span>);</span><br><span class="line">    <span class="comment">//&#x5C06;&#x6570;&#x636E;name&#x4FDD;&#x5B58;&#x5728;Tag&#x5F53;&#x4E2D;</span></span><br><span class="line">    viewHolder.tv_name.setTag(userEnity.getName());</span><br><span class="line">    <span class="comment">//&#x5C06;&#x6570;&#x636E;image_url&#x4FDD;&#x5B58;&#x5728;Tag&#x5F53;&#x4E2D;</span></span><br><span class="line">    viewHolder.iv_icon.setTag(img_url);</span><br><span class="line">    <span class="comment">//&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x663E;&#x793A;&#x56FE;&#x7247;&#xFF08;&#x6700;&#x597D;&#x662F;&#x672C;&#x5730;&#x8D44;&#x6E90;&#x7684;&#x56FE;&#x7247;&#xFF09;</span></span><br><span class="line">    viewHolder.iv_icon.setImageResource(R.mipmap.ic_launcher);</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">&#x8BBE;&#x7F6E;&#x76D1;&#x542C;</span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="typename">void</span> onScrollStateChanged(AbsListView view, <span class="typename">int</span> scrollState) {</span><br><span class="line">    <span class="keyword">switch</span> (scrollState){</span><br><span class="line">        <span class="keyword">case</span> AbsListView.OnScrollListener.<span class="string">SCROLL_STATE_IDLE:</span><span class="comment">//&#x505C;&#x6B62;&#x6EDA;&#x52A8;</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">//&#x8BBE;&#x7F6E;&#x4E3A;&#x505C;&#x6B62;&#x6EDA;&#x52A8;</span></span><br><span class="line">            myAdapter.setScrollState(<span class="literal">false</span>);</span><br><span class="line">            <span class="comment">//&#x5F53;&#x524D;&#x5C4F;&#x5E55;&#x4E2D;listview&#x7684;&#x5B50;&#x9879;&#x7684;&#x4E2A;&#x6570;</span></span><br><span class="line">            <span class="typename">int</span> count = view.getChildCount();</span><br><span class="line">            Log.e(<span class="string">&quot;MainActivity&quot;</span>,count+<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="typename">int</span> i = <span class="number">0</span>; i &lt; count; i++) {</span><br><span class="line">                <span class="comment">//&#x83B7;&#x53D6;&#x5230;item&#x7684;name</span></span><br><span class="line">                TextView tv_name = (TextView) view.getChildAt(i).findViewById(R.id.main_item_tv_name);</span><br><span class="line">                <span class="comment">//&#x83B7;&#x53D6;&#x5230;item&#x7684;&#x5934;&#x50CF;</span></span><br><span class="line">                ImageView iv_show= (ImageView) view.getChildAt(i).findViewById(R.id.main_item_iv_icon);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (tv_name.getTag() != <span class="literal">null</span>) { <span class="comment">//&#x975E;null&#x8BF4;&#x660E;&#x9700;&#x8981;&#x52A0;&#x8F7D;&#x6570;&#x636E;</span></span><br><span class="line">                    tv_name.setText(tv_name.getTag().toString());<span class="comment">//&#x76F4;&#x63A5;&#x4ECE;Tag&#x4E2D;&#x53D6;&#x51FA;&#x6211;&#x4EEC;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;name&#x5E76;&#x4E14;&#x8D4B;&#x503C;</span></span><br><span class="line">                    tv_name.setTag(<span class="literal">null</span>);<span class="comment">//&#x8BBE;&#x7F6E;&#x4E3A;&#x5DF2;&#x52A0;&#x8F7D;&#x8FC7;&#x6570;&#x636E;</span></span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!iv_show.getTag().equals(<span class="string">&quot;1&quot;</span>)){<span class="comment">//!=&quot;1&quot;&#x8BF4;&#x660E;&#x9700;&#x8981;&#x52A0;&#x8F7D;&#x6570;&#x636E;</span></span><br><span class="line">                    String image_url=iv_show.getTag().toString();<span class="comment">//&#x76F4;&#x63A5;&#x4ECE;Tag&#x4E2D;&#x53D6;&#x51FA;&#x6211;&#x4EEC;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;image&#x2014;&#x2014;url</span></span><br><span class="line">                    ImageLoader.getInstance().displayImage(image_url, iv_show);<span class="comment">//&#x663E;&#x793A;&#x56FE;&#x7247;</span></span><br><span class="line">                    iv_show.setTag(<span class="string">&quot;1&quot;</span>);<span class="comment">//&#x8BBE;&#x7F6E;&#x4E3A;&#x5DF2;&#x52A0;&#x8F7D;&#x8FC7;&#x6570;&#x636E;</span></span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> AbsListView.OnScrollListener.<span class="string">SCROLL_STATE_FLING:</span><span class="comment">//&#x6EDA;&#x52A8;&#x505A;&#x51FA;&#x4E86;&#x629B;&#x7684;&#x52A8;&#x4F5C;</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">//&#x8BBE;&#x7F6E;&#x4E3A;&#x6B63;&#x5728;&#x6EDA;&#x52A8;</span></span><br><span class="line">            myAdapter.setScrollState(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> AbsListView.OnScrollListener.<span class="string">SCROLL_STATE_TOUCH_SCROLL:</span><span class="comment">//&#x6B63;&#x5728;&#x6EDA;&#x52A8;</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">//&#x8BBE;&#x7F6E;&#x4E3A;&#x6B63;&#x5728;&#x6EDA;&#x52A8;</span></span><br><span class="line">            myAdapter.setScrollState(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5C40;&#x90E8;&#x66F4;&#x65B0;&#xFF1A;<br><a href="http://blog.csdn.net/nupt123456789/article/details/39432781" target="_blank" rel="external">http://blog.csdn.net/nupt123456789/article/details/39432781</a><br><a href="http://www.cnblogs.com/liuling/p/2015-10-20-01.html" target="_blank" rel="external">http://www.cnblogs.com/liuling/p/2015-10-20-01.html</a><br><figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> void updateProgressPartly(<span class="built_in">int</span> progress,<span class="built_in">int</span> <span class="keyword">position</span>){</span><br><span class="line">    <span class="built_in">int</span> firstVisiblePosition = listview.getFirstVisiblePosition();</span><br><span class="line">    <span class="built_in">int</span> lastVisiblePosition = listview.getLastVisiblePosition();</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">position</span>&gt;=firstVisiblePosition &amp;&amp; <span class="keyword">position</span>&lt;=lastVisiblePosition){</span><br><span class="line">        View view = listview.getChildAt(<span class="keyword">position</span> - firstVisiblePosition);</span><br><span class="line">        <span class="keyword">if</span>(view.getTag() instanceof ViewHolder){</span><br><span class="line">            ViewHolder vh = (ViewHolder)view.getTag();</span><br><span class="line">            vh.pb.setProgress(progress);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF1A;</p>
<p>&#x5176;&#x5B9E;ListView&#x4F18;&#x5316;&#x7684;&#x6700;&#x6839;&#x672C;&#x9014;&#x5F84;&#x5728;&#x4E8E;getView&#x65B9;&#x6CD5;&#x7684;&#x4F18;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4F18;&#x5316;&#x5C31;&#x9700;&#x8981;&#x5C06;&#x4E00;&#x5207;&#x8017;&#x65F6;&#x7684;&#x64CD;&#x4F5C;&#x4ECE;getView&#x4E2D;&#x62BD;&#x79BB;&#xFF0C;&#x6BD4;&#x5982;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#xFF0C;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#xFF0C;&#x6587;&#x4EF6;&#x52A0;&#x8F7D;&#x3002;<br>&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x51E0;&#x79CD;&#x9014;&#x5F84;&#x6765;&#x4F18;&#x5316;&#xFF1A;</p>
<ol>
<li>&#x542F;&#x52A8;&#x7EBF;&#x7A0B;&#x6765;&#x5F02;&#x6B65;&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#xFF0C;&#x5728;&#x56FE;&#x7247;&#x5C1A;&#x672A;&#x52A0;&#x8F7D;&#x5B8C;&#x6210;&#x4E4B;&#x524D;&#x5148;&#x7528;&#x7A7A;&#x767D;&#x56FE;&#x7247;&#x5360;&#x4F4D;</li>
<li>&#x6ED1;&#x52A8;&#x65F6;&#x4E0D;&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#xFF0C;&#x505C;&#x6B62;&#x6ED1;&#x52A8;&#x65F6;&#x52A0;&#x8F7D;</li>
<li>&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x673A;&#x5236;&#x5C06;&#x5176;&#x7F13;&#x5B58;&#x5230;&#x5185;&#x5B58;&#x4E2D;&#xFF08;&#x6CE8;&#x610F;&#x4F7F;&#x7528;&#x5F31;&#x5F15;&#x7528;&#xFF09;</li>
<li>&#x5C40;&#x90E8;&#x5237;&#x65B0;</li>
<li>Item&#x4E2D;&#x7684;&#x63A7;&#x4EF6;&#x5BBD;&#x9AD8;&#x5C3D;&#x91CF;&#x5199;&#x6210;&#x56FA;&#x5B9A;&#x7684;&#x503C;&#x6216;&#x8005;math_parent&#xFF0C;&#x907F;&#x514D;&#x5F71;&#x54CD;&#x5176;&#x4ED6;&#x63A7;&#x4EF6;&#x7684;&#x4F4D;&#x7F6E;&#x5BFC;&#x81F4;&#x91CD;&#x65B0;&#x7ED8;&#x5236;</li>
<li>&#x51CF;&#x5C11;&#x5E03;&#x5C40;&#x5C42;&#x6B21;&#xFF0C;&#x7F29;&#x77ED;&#x7ED8;&#x5236;&#x65F6;&#x95F4;&#x3002;&#x614E;&#x7528; layout_weight &#x7C7B;&#x4F3C;&#x5C5E;&#x6027;&#xFF0C;&#x4EE5;&#x4FBF;&#x7F29;&#x77ED;&#x5E03;&#x5C40;&#x7684; Measure &#x65F6;&#x95F4;&#x3002;</li>
<li>&#x4F7F;&#x7528;RecyclerView&#xFF0C;RecyclerView&#x63D0;&#x4F9B;&#x4E86;&#x539F;&#x751F;&#x7684;&#x5C40;&#x90E8;&#x5237;&#x65B0;&#x529F;&#x80FD;</li>
<li>&#x5728;&#x52A0;&#x8F7D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E3A;ImageView&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;Tag&#xFF0C;&#x6BD4;&#x5982;imageView.setTag(image_url),&#x4E0B;&#x4E00;&#x6B21;&#x518D;&#x52A0;&#x8F7D;&#x4E4B;&#x524D;&#xFF0C;&#x9996;&#x5148;&#x83B7;&#x53D6;Tag&#xFF0C;&#x6BD4;&#x5982;imageUrl = imageView.getTag(),&#x5982;&#x679C;&#x6B64;&#x65F6;&#x7684;&#x5730;&#x5740;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x5730;&#x5740;&#x4E00;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x52A0;&#x8F7D;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x518D;&#x52A0;&#x8F7D;&#x3002;</li>
</ol>
<p>&#x6700;&#x540E;&#x662F;&#x4E4B;&#x524D;&#x5F00;&#x53D1;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x4E24;&#x79CD;ListView&#x9519;&#x4F4D;&#x7684;&#x95EE;&#x9898;&#xFF1A;<br>&#x4E0B;&#x9762;&#x662F;&#x5F53;&#x65F6;&#x7684;&#x53C2;&#x8003;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x540E;&#x7EED;&#x6709;&#x7A7A;&#x7684;&#x65F6;&#x5019;&#x518D;&#x5BF9;&#x8FD9;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x4E13;&#x95E8;&#x603B;&#x7ED3;&#xFF1A;<br><a href="http://www.cnblogs.com/lesliefang/p/3619223.html" target="_blank" rel="external">http://www.cnblogs.com/lesliefang/p/3619223.html</a><br><a href="http://www.runoob.com/w3cnote/android-tutorial-listview-checkbox.html" target="_blank" rel="external">http://www.runoob.com/w3cnote/android-tutorial-listview-checkbox.html</a><br><a href="http://www.trinea.cn/android/android-listview-display-error-image-when-scroll/" target="_blank" rel="external">http://www.trinea.cn/android/android-listview-display-error-image-when-scroll/</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android-源码分析/">Android 源码分析</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/AOSP-源码/">AOSP 源码</a>
  </div>

</div>



</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/07/28/Android-源码分析之Handler-MessageQueue-Looper/" title="Android 源码分析之Handler MessageQueue Looper">
  <span>
  Android 源码分析之Handler MessageQueue Looper</span>
</a>
</div>


<div class="next">
<a href="/2016/07/26/Android-进阶之软引用和弱引用/"  title="Android 进阶之软引用和弱引用">
 <span>Android 进阶之软引用和弱引用
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/07/27/Android-源码分析之ListView/" data-title="Android-源码分析之ListView" data-url="http://yoursite.com/2016/07/27/Android-源码分析之ListView/"></div>
</section>


<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 <ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#ListView-缓存机制的实现"><span class="toc-number">1.</span> <span class="toc-text">ListView 缓存机制的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#RecycleBin原理概述"><span class="toc-number">1.1.</span> <span class="toc-text">RecycleBin原理概述</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ListView的优化"><span class="toc-number">2.</span> <span class="toc-text">ListView的优化</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-img"></div>		
	
	<div class="social-info" class="clearfix">
		
		
		<a href="https://github.com/tbfungeek" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:tbfungeek@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		

	</div>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
			<li><a href="/categories/Android-小经验/" title="Android 小经验">Android 小经验<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android-源码分析/" title="Android 源码分析">Android 源码分析<sup>17</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android其他/" title="Android其他">Android其他<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android初步/" title="Android初步">Android初步<sup>21</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android进阶/" title="Android进阶">Android进阶<sup>100</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hexo-使用/" title="Hexo 使用">Hexo 使用<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/OpenCV/" title="OpenCV">OpenCV<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/ROS/" title="ROS">ROS<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/个人收藏/" title="个人收藏">个人收藏<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/其他/" title="其他">其他<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/叨叨系列/" title="叨叨系列">叨叨系列<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/工作总结/" title="工作总结">工作总结<sup>1</sup></a></li>
		  
		
		  
		
		  
			<li><a href="/categories/树莓派/" title="树莓派">树莓派<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/版本控制/" title="版本控制">版本控制<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Android-设计模式/" title="Android 设计模式">Android 设计模式<sup>29</sup></a></li>
			
		
			
				<li><a href="/tags/Android基础/" title="Android基础">Android基础<sup>21</sup></a></li>
			
		
			
				<li><a href="/tags/AOSP-源码/" title="AOSP 源码">AOSP 源码<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/Android-常用第三方库/" title="Android 常用第三方库">Android 常用第三方库<sup>15</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo-使用/" title="Hexo 使用">Hexo 使用<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/ROS/" title="ROS">ROS<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Android-动画进阶/" title="Android 动画进阶">Android 动画进阶<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/OpenCV/" title="OpenCV">OpenCV<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-绘图进阶/" title="Android 绘图进阶">Android 绘图进阶<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-自动化测试/" title="Android 自动化测试">Android 自动化测试<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android性能优化/" title="Android性能优化">Android性能优化<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-JNI/" title="Android JNI">Android JNI<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/树莓派/" title="树莓派">树莓派<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Android-自定义View进阶/" title="Android 自定义View进阶">Android 自定义View进阶<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Android质量管理工具/" title="Android质量管理工具">Android质量管理工具<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/重要控件/" title="重要控件">重要控件<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/工具的使用/" title="工具的使用">工具的使用<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Android-事件处理进阶/" title="Android 事件处理进阶">Android 事件处理进阶<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/编程技巧/" title="编程技巧">编程技巧<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Android开发流程/" title="Android开发流程">Android开发流程<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">聯結</p>
    <ul>
        
          <li>
            
            	<a href="https://hexo.io" target="_blank" title="Hexo">Hexo</a>
            
          </li>
        
          <li>
            
            	<a href="https://pages.github.com/" target="_blank" title="GitHub">GitHub</a>
            
          </li>
        
          <li>
            
            	<a href="http://pf18.github.io/" target="_blank" title="PF18">PF18</a>
            
          </li>
        
          <li>
            
            	<a href="http://toutiao.io/" target="_blank" title="开发者头条">开发者头条</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.jcodecraeer.com/" target="_blank" title="泡在网上的日子">泡在网上的日子</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

  
  <div class="tagcloudlist">
    <p class="asidetitle">標簽雲</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/AOSP-源码/" style="font-size: 18.18px;">AOSP 源码</a> <a href="/tags/Android-APK-签名/" style="font-size: 10px;">Android APK 签名</a> <a href="/tags/Android-JNI/" style="font-size: 13.64px;">Android JNI</a> <a href="/tags/Android-事件处理进阶/" style="font-size: 10.91px;">Android 事件处理进阶</a> <a href="/tags/Android-动画进阶/" style="font-size: 14.55px;">Android 动画进阶</a> <a href="/tags/Android-多线程开发/" style="font-size: 10px;">Android 多线程开发</a> <a href="/tags/Android-小经验/" style="font-size: 10px;">Android 小经验</a> <a href="/tags/Android-常用第三方库/" style="font-size: 17.27px;">Android 常用第三方库</a> <a href="/tags/Android-开发流程/" style="font-size: 10px;">Android 开发流程</a> <a href="/tags/Android-绘图进阶/" style="font-size: 13.64px;">Android 绘图进阶</a> <a href="/tags/Android-自动化测试/" style="font-size: 13.64px;">Android 自动化测试</a> <a href="/tags/Android-自定义View进阶/" style="font-size: 12.73px;">Android 自定义View进阶</a> <a href="/tags/Android-设计模式/" style="font-size: 20px;">Android 设计模式</a> <a href="/tags/Android其他/" style="font-size: 10px;">Android其他</a> <a href="/tags/Android基础/" style="font-size: 19.09px;">Android基础</a> <a href="/tags/Android开发流程/" style="font-size: 10px;">Android开发流程</a> <a href="/tags/Android性能优化/" style="font-size: 13.64px;">Android性能优化</a> <a href="/tags/Android混淆技术/" style="font-size: 10px;">Android混淆技术</a> <a href="/tags/Android质量管理工具/" style="font-size: 11.82px;">Android质量管理工具</a> <a href="/tags/Android逆向工程/" style="font-size: 10px;">Android逆向工程</a> <a href="/tags/Git-github/" style="font-size: 10px;">Git && github</a> <a href="/tags/Hexo-使用/" style="font-size: 16.36px;">Hexo 使用</a> <a href="/tags/Linux-使用/" style="font-size: 10px;">Linux 使用</a> <a href="/tags/OpenCV/" style="font-size: 13.64px;">OpenCV</a> <a href="/tags/ROS/" style="font-size: 15.45px;">ROS</a> <a href="/tags/叨叨系列/" style="font-size: 10px;">叨叨系列</a> <a href="/tags/工作总结/" style="font-size: 10px;">工作总结</a> <a href="/tags/工具的使用/" style="font-size: 11.82px;">工具的使用</a> <a href="/tags/杂类/" style="font-size: 10px;">杂类</a> <a href="/tags/树莓派/" style="font-size: 12.73px;">树莓派</a> <a href="/tags/编程技巧/" style="font-size: 10.91px;">编程技巧</a> <a href="/tags/网站收藏/" style="font-size: 10px;">网站收藏</a> <a href="/tags/重要控件/" style="font-size: 11.82px;">重要控件</a>
    </div>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
		
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/hsihohuang/kiddochan" target="_blank" title="Kiddochan">Kiddochan</a> © 2016 
		
		<a href="/about" target="_blank" title="Edgar">Edgar</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"tbfungeek"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 


<script type="text/javascript">

var disqus_shortname = 'tbfungeek';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?bf2e977415bba8cfe0014075b580ec7b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
